# ESP32-S3-Touch-AMOLED-1.8 (Waveshare) - Описание устройства

## Общая информация

**ESP32-S3-Touch-AMOLED-1.8** — высокопроизводительная плата разработки от Waveshare на базе ESP32-S3 с AMOLED дисплеем 1.8" и емкостным тач-экраном. Несмотря на компактный размер, устройство интегрирует множество периферийных компонентов для удобной разработки.

**Официальная документация:** [Waveshare Wiki - ESP32-S3-Touch-AMOLED-1.8](https://www.waveshare.com/wiki/ESP32-S3-Touch-AMOLED-1.8)

---

## Основные характеристики

### Физические параметры
- **Вес:** 38 грамм
- **Толщина:** 14 мм (самое тонкое сенсорное устройство в категории)
- **Корпус:** ABS-пластик
- **Форм-фактор:** Компактный карманный формат

### Дисплей
- **Тип:** AMOLED (Active Matrix Organic Light-Emitting Diode)
- **Размер:** 1.8 дюйма
- **Разрешение:** 368×448 пикселей (нативное)
- **Цвета:** 16.7M цветов
- **Драйвер:** SH8601
- **Интерфейс:** QSPI (Quad SPI)
- **Максимальная яркость:** 350 nit
- **Управление яркостью:** Через QSPI регистр 0x51 (0x00-0xFF), или функция `gfx->Display_Brightness(i)` где i = 0-255
- **Соотношение сторон:** ~0.82:1 (вертикальный формат, высота больше ширины на ~22%)
- **Сенсор:** Емкостный тач-экран FT3168
- **Интерфейс тача:** I2C (10Khz~400Khz настраиваемая скорость)
- **Даун-скейлинг:** Допускается использование меньших разрешений при сохранении соотношения сторон

**Варианты даун-скейлинга:**
- **368×448** (100%) — нативное разрешение, максимальное качество
- **276×336** (75%) — хороший баланс качества и производительности
- **184×224** (50%) — половина от нативного, экономия ресурсов
- **240×292** (~65%) — близко к исходному разрешению проекта (240×240)

**Особенности:**
- Высокое качество изображения
- Глубокий черный цвет (пиксели выключены = экономия энергии)
- Высокая контрастность
- Широкие углы обзора
- Энергосбережение на темных темах

### Микроконтроллер
- **MCU:** ESP32-S3R8
- **Процессор:** Xtensa® 32-bit LX7 dual-core, до 240 MHz
- **WiFi:** 2.4GHz Wi‑Fi (802.11 b/g/n)
- **Bluetooth:** Bluetooth 5 (BLE)
- **Память:** 512KB SRAM, 384KB ROM, 8MB PSRAM, 16MB Flash
- **Антенна:** Встроенная SMD антенна

### Питание
- **Батарея:** 400 мАч (рекомендуется 3.85×24×28 мм), поставляемая батарея 350 мАч (только для Китая)
- **Интерфейс батареи:** MX1.25 2P коннектор, 3.7V Li-ion/Li-Po
- **PMIC:** AXP2101 (управление питанием, зарядка, несколько выходных напряжений)
- **Автономность:**
  - ~1 час при полной яркости экрана
  - 3-4 часа при выключенной подсветке
  - ~6 часов в режиме низкого энергопотребления
- **Зарядка:** USB-C (ESP32-S3 native USB)
- **Резервная батарея:** Площадка для резервной батареи RTC (поддержка RTC при замене основной батареи)

---

## Элементы управления

### Физические кнопки

Устройство имеет **2 физические кнопки**:

#### Кнопка BOOT
- **Расположение:** Боковая сторона устройства
- **Пин:** GPIO0
- **Функции:**
  - **При включении:** Зажать BOOT + включить питание → вход в режим загрузки (download mode)
  - **В рабочем режиме:** GPIO0 определяет высокий/низкий уровень (низкий = нажата)
  - **Поддерживаемые действия:** Одиночное нажатие, двойное нажатие, множественное нажатие, долгое нажатие
- **Использование:** Программируемая, можно использовать для пользовательских функций

#### Кнопка PWR
- **Расположение:** Боковая сторона устройства
- **Пин:** EXIO4 (через TCA9554 GPIO expander)
- **Функции:**
  - **Управление питанием:** 
    - В выключенном состоянии: нажатие → включение
    - Во включенном состоянии: удержание 6 секунд → выключение
  - **В рабочем режиме:** EXIO4 определяет высокий/низкий уровень (высокий = нажата)
  - **Поддерживаемые действия:** Одиночное нажатие, двойное нажатие, множественное нажатие, долгое нажатие (не более 6 секунд, иначе выключение)
- **Использование:** Программируемая, можно использовать для пользовательских функций

**Примечание:** Обе кнопки программируемые и могут использоваться для пользовательских функций в рабочем режиме.

### Сенсорный экран (Touch Screen)

#### Тип сенсора
- **Технология:** Емкостный тач-экран (self-capacitance)
- **Контроллер:** FT3168
- **Интерфейс:** I2C
- **Скорость связи:** 10Khz~400Khz (настраиваемая)
- **Материал:** Закаленное стекло + тонкопленочный материал (высокая прочность, высокая твердость, хорошая светопропускаемость)

#### Возможности управления через тач
- **Тап (Tap):** Одиночное касание для выбора/активации
- **Долгий тап (Long Press):** Длительное удержание для контекстных действий
- **Свайп (Swipe):** Проведение пальцем для навигации/прокрутки
  - Вертикальный свайп: Прокрутка списков, переключение между элементами
  - Горизонтальный свайп: Переключение между экранами/вкладками
- **Мультитач жесты:** Требует уточнения поддержки (pinch-to-zoom, rotate и т.д.)

#### Зоны тач-экрана
- **Активная область:** Вся поверхность дисплея (1.8")
- **Минимальный размер элементов:** Рекомендуется не менее 44×44 пикселей для удобного нажатия
- **Защита от случайных нажатий:** Требует программной реализации (dead zones, подтверждения)

---

## Адаптация для проекта TamaFi

### Текущая конфигурация TamaFi
Проект TamaFi изначально разработан для устройства с:
- **6 физическими кнопками** (3 слева: UP/OK/DOWN, 3 справа: R1/R2/R3)
- **TFT ST7789 240×240** дисплей
- **Без тач-экрана**

### Необходимые изменения для MiiBestOD

#### 1. Адаптация управления
- **Проблема:** MiiBestOD имеет только 2 физические кнопки вместо 6
- **Решение:**
  - Использовать тач-экран для эмуляции недостающих кнопок
  - Создать виртуальные кнопки на экране
  - Реализовать жесты для навигации
  - Комбинировать физические кнопки с тач-управлением

#### 2. Адаптация дисплея
- **Проблема:** Разрешение и тип дисплея отличаются (AMOLED vs TFT)
- **Решение (выбранный подход):**
  - **Апскейл квадратного контента:**
    - Основной контент остается в разрешении 240×240 (родные спрайты)
    - Масштабировать до 368×368 при выводе на экран (масштаб 1.533×)
    - Размещать в верхней области экрана (0,0 - 368,368)
  - **Область управления:**
    - Нижняя область 368×80 пикселей для виртуальных кнопок и UI элементов
    - Использовать для тач-управления и дополнительной информации
  - **Преимущества:**
    - Минимальные изменения в коде рендеринга
    - Родные спрайты остаются в исходном разрешении
    - Эффективное использование всего экрана
    - Дополнительное пространство для управляющих элементов
  - **Дополнительно:**
    - Использовать преимущества AMOLED (темные темы, экономия энергии)
    - Обновить библиотеку дисплея (возможно, потребуется другая библиотека)

#### 3. Оптимизация энергопотребления
- **Преимущество:** AMOLED экономит энергию на черных пикселях
- **Рекомендации:**
  - Использовать темные темы UI
  - Минимизировать белые/светлые элементы
  - Реализовать режим энергосбережения с затемнением экрана

---

## Библиотеки и драйверы

### Дисплей
- **Библиотека:** GFX_Library_for_Arduino (v1.4.9)
  - Установка: "Install Offline" (из демо-проекта)
  - Драйвер: Arduino_SH8601
  - Интерфейс: QSPI (Arduino_ESP32QSPI)
- **Инициализация:**
  ```cpp
  Arduino_DataBus *bus = new Arduino_ESP32QSPI(
    LCD_CS, LCD_SCLK, LCD_SDIO0, LCD_SDIO1, LCD_SDIO2, LCD_SDIO3);
  Arduino_GFX *gfx = new Arduino_SH8601(bus, -1 /* RST */,
    0 /* rotation */, false /* IPS */, LCD_WIDTH, LCD_HEIGHT);
  ```
- **Управление яркостью:** `gfx->Display_Brightness(i)` где i = 0-255

### Тач-экран
- **Библиотека:** Arduino_DriveBus
  - Установка: "Install Offline" (из демо-проекта)
  - Драйвер: FT3168 (через I2C)
- **Дополнительно:** ESP32_IO_Expander (v0.0.3) для TCA9554 GPIO expander
  - Используется для управления дополнительными пинами
- **Инициализация тача:**
  ```cpp
  FT3168->IIC_Init(IIC_SDA, IIC_SCL);
  FT3168->IIC_Write_Device_Value(FT3168->Arduino_IIC_Touch::Value_Information::TOUCH_POWER_MODE, FT3168->Arduino_IIC_Touch::Power_Mode::MONITOR);
  ```
- **Чтение координат:**
  ```cpp
  int32_t touchX = FT3168->IIC_Read_Device_Value(FT3168->Arduino_IIC_Touch::Value_Information::TOUCH_COORDINATE_X);
  int32_t touchY = FT3168->IIC_Read_Device_Value(FT3168->Arduino_IIC_Touch::Value_Information::TOUCH_COORDINATE_Y);
  ```

### Дополнительные библиотеки
- **LVGL:** v8.4.0 (опционально, для продвинутого UI)
- **SensorLib:** v0.2.1 (для QMI8658 IMU, PCF85063 RTC)
- **XPowersLib:** v0.2.6 (для AXP2101 PMIC)

---

## Распиновка (Pinout)

### Кнопки
- **BOOT:** GPIO0 (низкий уровень = нажата)
- **PWR:** EXIO4 через TCA9554 GPIO expander (высокий уровень = нажата)

### Дисплей (QSPI)
- **LCD_CS:** (определяется в Mylibrary)
- **LCD_SCLK:** (определяется в Mylibrary)
- **LCD_SDIO0, LCD_SDIO1, LCD_SDIO2, LCD_SDIO3:** (QSPI линии данных)

### Тач-экран (I2C)
- **IIC_SDA:** (определяется в Mylibrary)
- **IIC_SCL:** (определяется в Mylibrary)

### Дополнительные компоненты
- **QMI8658 IMU:** I2C (SDA/SCL)
- **PCF85063 RTC:** I2C (SDA/SCL)
- **AXP2101 PMIC:** I2C (SDA/SCL)
- **TCA9554 GPIO Expander:** I2C (SDA/SCL)
- **ES8311 Audio Codec:** I2C + I2S
- **TF Card:** SPI (CS=EXIO7, MOSI=GPIO1, MISO=GPIO3, SCK=GPIO2)

**Примечание:** Точные определения пинов находятся в библиотеке Mylibrary из демо-проекта Waveshare.

---

## Преимущества для проекта TamaFi

1. **Компактность:** Самое тонкое устройство (14 мм) — идеально для карманного формата
2. **Качество экрана:** AMOLED обеспечивает премиальное качество изображения
3. **Энергоэффективность:** До 3 суток автономности при правильной оптимизации
4. **Тач-экран:** Расширенные возможности управления через жесты и виртуальные элементы
5. **Современность:** Bluetooth 5.0 для будущих функций

---

## Ограничения и вызовы

1. **Меньше физических кнопок:** Только 2 кнопки вместо 6 — требуется адаптация UI
2. **Другое разрешение:** Возможное отличие от 240×240 — требуется адаптация графики
3. **Другая библиотека дисплея:** Возможно, потребуется замена TFT_eSPI
4. **Тач-управление:** Требует реализации обработки касаний и жестов
5. **Документация:** Ограниченная доступность документации (требует поиска)

---

## Рекомендации по разработке

### Приоритет 1: Исследование
1. Найти официальную документацию MiiBestOD 1.8" AMOLED
2. Определить точное разрешение дисплея
3. Выяснить распиновку кнопок и тач-экрана
4. Найти подходящие библиотеки для дисплея и тача

### Приоритет 2: Адаптация базового функционала
1. Адаптировать разрешение дисплея
2. Реализовать базовое тач-управление
3. Создать виртуальные кнопки для недостающих физических
4. Протестировать основные функции TamaFi

### Приоритет 3: Оптимизация
1. Реализовать темную тему для экономии энергии
2. Оптимизировать UI под тач-экран
3. Добавить жесты для навигации
4. Настроить энергосбережение

---

## Ссылки и ресурсы

- **Официальная документация:** [Waveshare Wiki - ESP32-S3-Touch-AMOLED-1.8](https://www.waveshare.com/wiki/ESP32-S3-Touch-AMOLED-1.8)
- **Демо-проекты:** [ESP32-S3-Touch-AMOLED-1.8 Demo](https://files.waveshare.com/wiki/ESP32-S3-Touch-AMOLED-1.8/ESP32-S3-Touch-AMOLED-1.8-Demo.zip)
- **Схемы:** [Schematic Diagram](https://files.waveshare.com/wiki/ESP32-S3-Touch-AMOLED-1.8/ESP32-S3-Touch-AMOLED-1.8.pdf)
- **Datasheets:**
  - [SH8601 Datasheet](https://files.waveshare.com/wiki/common/SH8601A0_DataSheet_Preliminary_V0.0_UCS_191107_1_.pdf)
  - [FT3168 Datasheet](https://files.waveshare.com/wiki/common/FT3168.pdf)
  - [ESP32-S3 Datasheet](https://files.waveshare.com/wiki/common/Esp32-s3_datasheet_en.pdf)

---

## Статус документа

- **Дата создания:** 23 января 2026
- **Статус:** Требует уточнения технических деталей
- **Приоритет обновления:** Высокий (для адаптации проекта TamaFi)

---

**Примечание:** Многие технические детали требуют уточнения из официальной документации или путем тестирования устройства. Этот документ служит отправной точкой для адаптации проекта TamaFi под устройство MiiBestOD 1.8" AMOLED.
